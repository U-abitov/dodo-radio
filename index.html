<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dodo Pizza FM</title>
<style>
  body{background:#0f0f12;color:#fff;font-family:Arial,Helvetica,sans-serif;text-align:center;padding:28px}
  h1{color:#ffcc00;margin:0 0 10px;font-size:34px}
  #player{width:90%;margin-top:18px}
  #bigStart{display:none;background:#ffcc00;color:#111;border:0;padding:14px 22px;border-radius:8px;font-size:18px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.4)}
  #now{margin-top:12px;color:#ddd;font-size:14px}
</style>
</head>
<body>
  <h1>üéµ Dodo Pizza FM</h1>
  <audio id="player" controls></audio>
  <div id="now"></div>
  <button id="bigStart">Ba≈ülat ‚ñ∂ (Ba≈ülamak i√ßin tƒ±klayƒ±n)</button>

<script>
/*
  –ù–∞—Å—Ç—Ä–æ–π–∫–∞: —É–∫–∞–∂–∏ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ GitHub
  - GITHUB_OWNER: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
  - GITHUB_REPO: –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  - GITHUB_BRANCH: –≤–µ—Ç–∫–∞ (–æ–±—ã—á–Ω–æ "main" –∏–ª–∏ "master")
  –ü–∞–ø–∫–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: /music –∏ /ads
*/
const GITHUB_OWNER = "YOUR_GITHUB_USERNAME";
const GITHUB_REPO  = "YOUR_REPO_NAME";
const GITHUB_BRANCH = "main"; // –∏–ª–∏ "master"

const apiBase = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents`;
const rawBase = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/`;

const player = document.getElementById('player');
const bigStart = document.getElementById('bigStart');
const now = document.getElementById('now');

function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
}

async function getMp3List(folder){
  try{
    const res = await fetch(`${apiBase}/${folder}?ref=${GITHUB_BRANCH}`);
    if(!res.ok) {
      console.error('GitHub API error', res.status, await res.text());
      return [];
    }
    const data = await res.json();
    // data ‚Äî –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ { name, path, download_url, ... }
    const files = data
      .filter(item => /\.(mp3|m4a|ogg|wav)$/i.test(item.name))
      .map(item => rawBase + item.path);
    return files;
  } catch(e){
    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤:', e);
    return [];
  }
}

(async function init(){
  now.textContent = '–ó–∞–≥—Ä—É–∂–∞—é —Å–ø–∏—Å–∫–∏ —Ç—Ä–µ–∫–æ–≤...';
  const music = await getMp3List('music');
  const ads = await getMp3List('ads');

  if(music.length === 0 && ads.length === 0){
    now.textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ audio-—Ñ–∞–π–ª–∞ –≤ –ø–∞–ø–∫–∞—Ö /music –∏–ª–∏ /ads.';
    return;
  }
  if(music.length === 0){
    now.textContent = '–í /music –Ω–µ—Ç –ø–µ—Å–µ–Ω ‚Äî —Å–∞–π—Ç –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–µ–∫–ª–∞–º—É.';
  }

  function buildPlaylist(){
    // shuffle music order
    const mus = [...music];
    shuffleArray(mus);

    const pl = [];
    let count = 0;
    for(let i=0;i<mus.length;i++){
      pl.push({url: mus[i], label: decodeURIComponent(mus[i].split('/').pop())});
      count++;
      if(count % 10 === 0 && ads.length > 0){
        const a = ads[Math.floor(Math.random()*ads.length)];
        pl.push({url: a, label: decodeURIComponent(a.split('/').pop()), isAd: true});
      }
    }
    // –µ—Å–ª–∏ –º—É–∑—ã–∫–∏ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å —Ä–µ–∫–ª–∞–º–∞ ‚Äî –∫—Ä—É—Ç–∏–º —Ä–µ–∫–ª–∞–º—É –ø–æ –∫—Ä—É–≥—É
    if(pl.length === 0 && ads.length > 0){
      for(let a of ads){
        pl.push({url: a, label: decodeURIComponent(a.split('/').pop()), isAd:true});
      }
    }
    return pl;
  }

  let playlist = buildPlaylist();
  let idx = 0;

  function setNowText(item){
    now.textContent = (item.isAd ? '–†–µ–∫–ª–∞–º–∞ ‚Äî ' : '–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç ‚Äî ') + item.label;
  }

  async function tryPlay(i){
    const item = playlist[i];
    player.src = item.url;
    setNowText(item);
    try {
      await player.play();
      bigStart.style.display = 'none';
    } catch(e) {
      // autoplay –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî –ø–æ–∫–∞–∂–µ–º –±–æ–ª—å—à—É—é –∫–Ω–æ–ø–∫—É
      bigStart.style.display = 'inline-block';
    }
  }

  player.addEventListener('ended', async () => {
    idx++;
    if(idx >= playlist.length){
      playlist = buildPlaylist(); // –ø–µ—Ä–µ—Å—Ç—Ä–æ–∏–º ‚Äî –Ω–æ–≤–∞—è —Ä—É–ª–µ—Ç–∫–∞
      idx = 0;
    }
    await tryPlay(idx);
  });

  // –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
  await tryPlay(idx);

  // –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç–∞, –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç autoplay
  bigStart.addEventListener('click', async () => {
    try {
      await player.play();
      bigStart.style.display = 'none';
    } catch(e){
      console.error(e);
    }
  });

  now.textContent = '–ì–æ—Ç–æ–≤–æ ‚Äî –ø–ª–µ–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω. –ï—Å–ª–∏ –∑–≤—É–∫ –Ω–µ –Ω–∞—á–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî –Ω–∞–∂–º–∏—Ç–µ ¬´Ba≈ülat¬ª.';
})();
</script>
</body>
</html>

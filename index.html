<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>DODO FM</title>
<style>
  body {
    margin: 0;
    background-color: rgb(255, 78, 0);
    font-family: Arial, sans-serif;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    user-select: none;
  }
  h1 {
    margin: 20px 0 30px 0;
    font-size: 4rem;
    font-weight: 900;
    letter-spacing: 0.1em;
  }
  #playerContainer {
    background: rgba(0,0,0,0.25);
    border-radius: 20px;
    padding: 30px 40px;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    text-align: center;
    max-width: 600px;
    width: 90vw;
  }
  audio {
    display: none;
  }
  #currentTrack {
    font-size: 1.8rem;
    margin-bottom: 20px;
    height: 30px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  #controls {
    display: flex;
    justify-content: center;
    gap: 25px;
    margin-bottom: 15px;
  }
  button {
    background: transparent;
    border: 2.5px solid white;
    border-radius: 50%;
    width: 70px;
    height: 70px;
    color: white;
    font-size: 1.8rem;
    cursor: pointer;
    transition: background-color 0.25s, color 0.25s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  button:hover {
    background-color: white;
    color: rgb(255, 78, 0);
  }
  #timer {
    font-size: 1.5rem;
    letter-spacing: 0.05em;
  }
  #logo {
    margin-top: 40px;
    max-width: 180px;
    filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.7));
  }
</style>
</head>
<body>

<h1>DODO FM</h1>

<div id="playerContainer">
  <audio id="player" preload="auto"></audio>
  <div id="currentTrack">Загрузка...</div>
  <div id="controls">
    <button id="prevBtn" title="Назад">&#9664;&#9664;</button>
    <button id="shuffleBtn" title="Перемешать">&#128256;</button>
    <button id="restartBtn" title="Заново">&#8635;</button>
    <button id="playPauseBtn" title="Плей/Пауза">&#9658;</button>
    <button id="nextBtn" title="Вперёд">&#9654;&#9654;</button>
  </div>
  <div id="timer">00:00 / 00:00</div>
</div>

<img id="logo" src="logo.png" alt="DODO FM Лого">

<script>
  const musicCount = 57;
  const musics = [];
  for (let i = 1; i <= musicCount; i++) {
    musics.push(`music${i}.mp3`);
  }
  const ads = ['ad1.mp3', 'ad2.mp3'];
  
  // Функция для создания плейлиста с рекламой
  function createPlaylist() {
    const newPlaylist = [];
    let adIndex = 0;
    for (let i = 0; i < musics.length; i++) {
      newPlaylist.push(musics[i]);
      if ((i + 1) % 5 === 0 && i !== musics.length - 1) {
        newPlaylist.push(ads[adIndex]);
        adIndex = (adIndex + 1) % ads.length;
      }
    }
    return newPlaylist;
  }

  let playlist = createPlaylist();
  const player = document.getElementById('player');
  const currentTrackDisplay = document.getElementById('currentTrack');
  const playPauseBtn = document.getElementById('playPauseBtn');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const shuffleBtn = document.getElementById('shuffleBtn');
  const restartBtn = document.getElementById('restartBtn');
  const timer = document.getElementById('timer');

  let currentIndex = 0;
  let isPlaying = false;
  let isShuffle = false;
  let shuffledPlaylist = [];
  let playedIndexes = [];

  function formatTime(sec) {
    const m = Math.floor(sec / 60).toString().padStart(2, '0');
    const s = Math.floor(sec % 60).toString().padStart(2, '0');
    return `${m}:${s}`;
  }

  function updateTrackDisplay() {
    currentTrackDisplay.textContent = `Сейчас играет: ${playlist[currentIndex]}`;
  }

  function updateTimer() {
    const current = formatTime(player.currentTime);
    const duration = player.duration ? formatTime(player.duration) : "00:00";
    timer.textContent = `${current} / ${duration}`;
  }

  function playTrack(index) {
    if (index < 0) index = 0;
    if (index >= playlist.length) {
      // Когда плейлист закончился — пересоздаем и играем заново
      playlist = createPlaylist();
      currentIndex = 0;
      playTrack(currentIndex);
      return;
    }
    currentIndex = index;
    player.src = playlist[currentIndex];
    player.play();
    isPlaying = true;
    playPauseBtn.innerHTML = "&#10074;&#10074;"; // пауза
    updateTrackDisplay();
  }

  function playNext() {
    if (isShuffle) {
      playShuffled();
    } else {
      playTrack(currentIndex + 1);
    }
  }

  function playPrev() {
    if (isShuffle) {
      // В перемешивании назад пока просто первый трек
      playTrack(0);
    } else {
      playTrack(currentIndex - 1);
    }
  }

  function playShuffled() {
    if (playedIndexes.length === playlist.length) {
      playedIndexes = [];
    }
    let nextIndex;
    do {
      nextIndex = Math.floor(Math.random() * playlist.length);
    } while (playedIndexes.includes(nextIndex));
    playedIndexes.push(nextIndex);
    playTrack(nextIndex);
  }

  player.addEventListener('ended', playNext);
  player.addEventListener('timeupdate', updateTimer);

  playPauseBtn.addEventListener('click', () => {
    if (isPlaying) {
      player.pause();
      isPlaying = false;
      playPauseBtn.innerHTML = "&#9658;";
    } else {
      player.play();
      isPlaying = true;
      playPauseBtn.innerHTML = "&#10074;&#10074;";
    }
  });

  nextBtn.addEventListener('click', playNext);
  prevBtn.addEventListener('click', playPrev);

  shuffleBtn.addEventListener('click', () => {
    isShuffle = !isShuffle;
    shuffleBtn.style.color = isShuffle ? "rgb(255, 78, 0)" : "white";
    if (isShuffle) {
      playedIndexes = [];
    }
  });

  restartBtn.addEventListener('click', () => {
    playTrack(currentIndex);
  });

  // Стартуем с первого трека
  playTrack(0);
</script>

</body>
</html>
